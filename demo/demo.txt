
polygon ChainId = 137;
base sepolia ChainId = 84532;

1. deploy contracts on both chains
source .env 

// deploy on base 
forge script script/DeployAllContracts.s.sol \
  --rpc-url $BASE_SEPOLIA_RPC_URL \
  --private-key $PRIVATE_KEY \
  --broadcast

Bn254SignatureScheme contract deployed at:  0x3ECCcF672a2Eb282Dd2B7589EA6bD65B474a96C7
RUSD contract deployed at:  0x73E04901b3fA84b5bd6782d446751E91c4e2616C
Bridge contract deployed at:  0xc9A956345D9D6E5729Ddd934D7b9cfd8cdcE353E
Router contract deployed at:  0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd

// deploy on polygon
forge script script/DeployAllContracts.s.sol \
  --rpc-url $POLYGON_POS_RPC_URL \
  --private-key $PRIVATE_KEY \
  --broadcast

Bn254SignatureScheme contract deployed at:  0x3ECCcF672a2Eb282Dd2B7589EA6bD65B474a96C7
RUSD contract deployed at:  0x73E04901b3fA84b5bd6782d446751E91c4e2616C
Bridge contract deployed at:  0xc9A956345D9D6E5729Ddd934D7b9cfd8cdcE353E
Router contract deployed at:  0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd


2. configure contracts on base 

// permit messages from other src chain ids
cast send 0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd "allowSrcChainId(uint256,bool)" 137 true \
  --rpc-url $BASE_SEPOLIA_RPC_URL \
  --private-key $PRIVATE_KEY

// map src and dst token addresses and chain ids
cast send 0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd "setTokenMapping(uint256,address,address)" 137 0x73E04901b3fA84b5bd6782d446751E91c4e2616C 0x73E04901b3fA84b5bd6782d446751E91c4e2616C \
  --rpc-url $BASE_SEPOLIA_RPC_URL \
  --private-key $PRIVATE_KEY


3. configure contracts on polygon

// permit messages from other src chain ids
cast send 0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd "allowSrcChainId(uint256,bool)" 84532 true \
  --rpc-url $POLYGON_POS_RPC_URL \
  --private-key $PRIVATE_KEY

// map src and dst token addresses and chain ids
cast send 0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd "setTokenMapping(uint256,address,address)" 84532 0x73E04901b3fA84b5bd6782d446751E91c4e2616C 0x73E04901b3fA84b5bd6782d446751E91c4e2616C \
  --rpc-url $POLYGON_POS_RPC_URL \
  --private-key $PRIVATE_KEY

4. make a cross chain transfer request from polygon to base

// mint 50 to sender
cast send 0x73E04901b3fA84b5bd6782d446751E91c4e2616C "mint(address,uint256)" 0xDC21c5F25E196b0C7E13F2C6f3184368059047FF 50e18 \
    --rpc-url $POLYGON_POS_RPC_URL \
    --private-key $PRIVATE_KEY

// approve tokens for router contract
cast send 0x73E04901b3fA84b5bd6782d446751E91c4e2616C "approve(address,uint256)" 0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd 50e18 \
    --rpc-url $POLYGON_POS_RPC_URL \
    --private-key $PRIVATE_KEY

// make a bridge request from polygon pos to base sepolia 
// for 10e18 (send to a random recipient from anvil)
// router will extract the fee from the transfer amount
// and allocate portion of the fee for the solver 
// that fulfills the request on the destination chain id
cast send 0xd81DCC29f1B8EED20a5Bf18cA0875115d121Dffd "bridge(address,uint256,uint256,uint256,address,uint256)" \
    0x73E04901b3fA84b5bd6782d446751E91c4e2616C 10e18 1e18 84532 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f 2 \
    --rpc-url $POLYGON_POS_RPC_URL \
    --private-key $PRIVATE_KEY

// recipient token balances on both chain
cast call 0x73E04901b3fA84b5bd6782d446751E91c4e2616C "balanceOf(address)(uint256)" 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f \
    --rpc-url $POLYGON_POS_RPC_URL

cast call 0x73E04901b3fA84b5bd6782d446751E91c4e2616C "balanceOf(address)(uint256)" 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f \
    --rpc-url $BASE_SEPOLIA_RPC_URL
